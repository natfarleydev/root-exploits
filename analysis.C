// TODO set log scales foo'!

Double_t fitf(Double_t *x, Double_t *par)
{
  // A simple function to create I = G_0 V exp(V/V_0)
  return par[0]*x[0]*TMath::Exp(x[0]/par[1]);
}

void analysis() {
  // const Int_t N = 7;
  // ifstream fileVector[N];

  // fileVector[0].open("ATLAS_irradiated_12_Feb_2013_lights_off_for_real.dat2");
  // fileVector[1].open("ATLAS_irradiated_12_Feb_2013_lights_off_for_real.dat2");
  // fileVector[2].open("ATLAS_irradiated_12_Feb_2013.dat1");
  // fileVector[3].open("ATLAS_irradiated_12_Feb_2013.dat2");
  // fileVector[4].open("ATLAS_irradiated_12_Feb_2013.dat3");
  // fileVector[5].open("ATLAS_irradiated_12_Feb_2013.dat4");
  // fileVector[6].open("ATLAS_irradiated_12_Feb_2013.dat5");
  
  // ifstream fileVector;
  // fileVector.open("test_data.dat");

  // Some stuff for the logs
  // const Int_t nxbins = 1000;
  // Double_t xmin = 1E-3;
  // Double_t xmax = 1E3;
  // Double_t logxmin = TMath::Log10(xmin);
  // Double_t logxmax = TMath::Log10(xmax);
  // Double_t xbinwidth = (logxmax - logxmin)/nxbins;
  // Double_t xbins[nxbins+1];
  // xbins[0] = xmin;
  // for (Int_t i=1; i<=nxbins;i++) {
  //   xbins[i] =  xmin + TMath::Power(10,logxmin+i*xbinwidth);
  // }

  // const Int_t nybins = 1000;
  // Double_t ymin = 1E-9;
  // Double_t ymax = 1E1;
  // Double_t logymin = TMath::Log10(ymin);
  // Double_t logymax = TMath::Log10(ymax);
  // Double_t ybinwidth = (logymax - logymin)/nybins;
  // Double_t ybins[nybins+1];
  // ybins[0] = ymin;
  // for (Int_t i=1; i<=nybins;i++) {
  //   ybins[i] = ymin + TMath::Power(10,logymin+i*ybinwidth);
  // }

  // TH2F *h2 = new TH2F("h2","xy scatter",nxbins,xbins,nybins,ybins);
  

  // TGraph *g2 = new TGraph("test_data.dat");
  // g2->Draw("A*");
  TCanvas *c1 = new TCanvas("c1","c1",800,800);
  c1->SetGrid(1);
    // Some stuff for the logs
  const Int_t nxbins = 10;
  Double_t xmin = 1E-5;
  Double_t xmax = 250;
  Double_t logxmin = TMath::Log10(xmin);
  Double_t logxmax = TMath::Log10(xmax);
  Double_t xbinwidth = (logxmax - logxmin)/nxbins;
  Double_t xbins[nxbins+1];
  xbins[0] = xmin;
  for (Int_t i=1; i<=nxbins;i++) {
    xbins[i] =  xmin + TMath::Power(10,logxmin+i*xbinwidth);
  }

  const Int_t nybins = 10;
  Double_t ymin = 1E-9;
  Double_t ymax = 1E-2;
  Double_t logymin = TMath::Log10(ymin);
  Double_t logymax = TMath::Log10(ymax);
  Double_t ybinwidth = (logymax - logymin)/nybins;
  Double_t ybins[nybins+1];
  ybins[0] = ymin;
  for (Int_t i=1; i<=nybins;i++) {
    ybins[i] = ymin + TMath::Power(10,logymin+i*ybinwidth);
  } 
  TH2F *h2 = new TH2F("h2","12_2_2013_atlas_run.dat1",nxbins,xbins,nybins,ybins); // Define histogram, inc. axes
  h2->GetXaxis()->SetTitle("Forward Voltage, V_{F}");
  h2->GetYaxis()->SetTitle("Current, A");
  h2->Draw();
  
  TGraph *g2 = new TGraph("12_2_2013_atlas_run.dat1",format="%*lg %*lg %*lg %*lg %lg %lg %*lg %*lg %*lg %*lg %*lg %*lg %*lg %*lg %*lg %*lg %*lg %*lg %*lg %*lg %*lg %*lg %*lg %*lg %*lg",option=":,");
  // TGraph *g22 = new TGraph("28_01_2013_run.dat2",format="%*lg %*lg %*lg %*lg %lg %lg %*lg %*lg %*lg %*lg %*lg %*lg %*lg %*lg %*lg %*lg %*lg %*lg %*lg %*lg %*lg %*lg %*lg %*lg %*lg",option=":,");
  // TGraph *g23 = new TGraph("28_01_2013_run.dat3",format="%*lg %*lg %*lg %*lg %lg %lg %*lg %*lg %*lg %*lg %*lg %*lg %*lg %*lg %*lg %*lg %*lg %*lg %*lg %*lg %*lg %*lg %*lg %*lg %*lg",option=":,");
  // TGraph *g24 = new TGraph("28_01_2013_run.dat4",format="%*lg %*lg %*lg %*lg %lg %lg %*lg %*lg %*lg %*lg %*lg %*lg %*lg %*lg %*lg %*lg %*lg %*lg %*lg %*lg %*lg %*lg %*lg %*lg %*lg",option=":,");
    
  g2->Draw("*");
  // g22->Draw("*");
  // g23->Draw("*");
  // g24->Draw("*");

  TF1 *func = new TF1("fitf",fitf,1E-2,1,2);

  // func->SetParameters(7e-6,5);
  // func->Draw("same");

  // g2->Fit(func, "rw");
  // g22->Fit(func,"rw+");
  // g23->Fit(func,"rw+");
  // g24->Fit(func,"rw+");
  // func->SetParameters(5e-4,1);
  // g2->Fit(func,"r+");

  
  // TGraph *g23 = new TGraph("ATLAS_irradiated_12_Feb_2013.dat3",format="%*lg %*lg %*lg %*lg %lg %lg %*lg %*lg %*lg %*lg %*lg %*lg %*lg %*lg %*lg %*lg %*lg %*lg %*lg %*lg %*lg %*lg %*lg %*lg %*lg",option=":,");
  // g23->Draw("*");
  // TGraph *g24 = new TGraph("ATLAS_irradiated_12_Feb_2013.dat4",format="%*lg %*lg %*lg %*lg %lg %lg %*lg %*lg %*lg %*lg %*lg %*lg %*lg %*lg %*lg %*lg %*lg %*lg %*lg %*lg %*lg %*lg %*lg %*lg %*lg",option=":,");
  // g23->Draw("*");
  // TGraph *g25 = new TGraph("ATLAS_irradiated_12_Feb_2013.dat5",format="%*lg %*lg %*lg %*lg %lg %lg %*lg %*lg %*lg %*lg %*lg %*lg %*lg %*lg %*lg %*lg %*lg %*lg %*lg %*lg %*lg %*lg %*lg %*lg %*lg",option=":,");
  // g23->Draw("*");
  
  // for(Int_t j=0; j<N; j++) {
    // while (1) {
    //   string tmp;
    //   Double_t x=0;
    //   Double_t y=0;
    //   Double_t xset[3],yset[3];
    //   getline(fileVector[j],tmp,','); cout << tmp;
    //   getline(fileVector[j],tmp,','); cout << tmp;
    //   getline(fileVector[j],tmp,','); xset[0] = atof(tmp.c_str()); cout << tmp << " ";
    //   getline(fileVector[j],tmp,','); yset[0] = atof(tmp.c_str()); cout << tmp << " ";
    //   for(int i=0;i<3;i++) {getline(fileVector[j],tmp,','); cout << tmp << " ";}
    //   getline(fileVector[j],tmp,','); xset[1] = atof(tmp.c_str()); cout << tmp << " ";
    //   getline(fileVector[j],tmp,','); yset[1] = atof(tmp.c_str()); cout << tmp << " ";
    //   for(int i=0;i<3;i++) {getline(fileVector[j],tmp,','); cout << tmp << " ";}
    //   getline(fileVector[j],tmp,','); xset[2] = atof(tmp.c_str()); cout << tmp << " ";
    //   getline(fileVector[j],tmp,','); xset[2] = atof(tmp.c_str()); cout << tmp << " ";
    //   getline(fileVector[j],tmp,'\n'); cout << tmp << endl;
    //   // for(int i=0;i<3;i++) {getline(fileVector[j],tmp,','); cout << tmp << " ";}
    //   // for(int i=0;i<2;i++) {getline(fileVector[j],tmp,','); cout << tmp << " ";}
    //   // for(int i=0;i<3;i++) {getline(fileVector[j],tmp,','); cout << tmp << " ";}

    //   for (int i = 0; i<3; i++) x = x + xset[i];
    //   for (int i = 0; i<3; i++) y = y + yset[i];
    //   x = x/3;
    //   y = y/3;


    //   // fileVector[j] >> tmp >> tmp >> x >> y;
    //   // cout << tmp << ", " << x << ", " << y << endl;
    //   // fileVector[j] >> tmp >> tmp >> tmp >> tmp >> tmp >> tmp >> tmp >> tmp >> tmp >> tmp >> tmp >> tmp >> tmp >> tmp >> tmp >> tmp >> tmp >> tmp; // all the tmps are to get the file to read over. There is definitely a more elegant way to do this.
    //   if (!fileVector[j].good()) {
    // 	cout << "File is not good anymore, maybe it never was..." << endl;
    // 	break;
    //   }
    //   // if (nlines < 5) printf("x=%8f, y=%8f\n",x,y);
    //   printf("x=%8f, y=%8f\n",x,y);
    //   h2->Fill(x,y);
    //   // ntuple->Fill(x,y);
    //   // nlines++;
    // }
  // }

  // TF1 *func = new TF1("fitf",fitf,1E-2,1,2);

  // func->SetParameters(5e-6,1);
  // h2->Fit(func,"re");
  // h2->Draw();

  gPad->SetLogx(1);
  gPad->SetLogy(1);
  
  
}
