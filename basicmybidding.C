#include "Riostream.h"

Double_t fitf(Double_t *x, Double_t *par)
{
//    Double_t arg = 0;
//    if (par[2] != 0) arg = (x[0] - par[1])/par[2];

//    Double_t fitval = par[0]*TMath::Exp(-0.5*arg*arg);
//    return fitval;

  return par[0]*TMath::Power(x[0],par[1]);
}

Double_t fitf2(Double_t *x, Double_t *par)
{
//    Double_t arg = 0;
//    if (par[2] != 0) arg = (x[0] - par[1])/par[2];

//    Double_t fitval = par[0]*TMath::Exp(-0.5*arg*arg);
//    return fitval;

  return par[0]*TMath::Power(x[0],par[1]);
}

void basicmybidding() {
//  Read data from an ascii file and create a root file with an histogram and an ntuple.
//   see a variant of this macro in basic2.C
//Author: Rene Brun
      

// read file $ROOTSYS/tutorials/tree/basic.dat
// this file has 3 columns of float data
   TString dir = gSystem->UnixPathName(gInterpreter->GetCurrentMacroName());
   dir.ReplaceAll("basicmybidding.C","");
   dir.ReplaceAll("/./","/");
   ifstream in;
   in.open(Form("%sresults.dat",dir.Data()));

   Float_t x,y;
   Int_t nlines = 0;
   TFile *f = new TFile("basic.root","RECREATE");
   TH2F *h2 = new TH2F("h2","xy scatter",1000,1E11,1E14,1000,0,4);
   TNtuple *ntuple = new TNtuple("ntuple","data from ascii file","x:y");

   while (1) {
     in >> x >> y;
     if (!in.good()) break;
     if (nlines < 5) printf("x=%8f, y=%8f\n",x,y);
     h2->Fill(x,y);
     ntuple->Fill(x,y);
     nlines++;
   }
   printf(" found %d points\n",nlines);

   in.close();

   f->Write();

   h2->Draw();
   // TF1 *g1 = new TF1("g1","pol10",6E11,4E13);
   // h2->Fit(g1,"R");
   // g1->SetLineWidth(1);
	   
// Creates a Root function based on function fitf above
   TF1 *func = new TF1("fitf",fitf,6E11,5E12,2);
   TF1 *func2 = new TF1("fitf2",fitf2,5.2E12,3E13,2);

// Sets initial values and parameter names
   func->SetParameters(0.5,1);
   func2->SetParameters(0.5,2);
   // func->SetParNames("constant","index");

// Fit histogram in range defined by function
   h2->Fit(func,"r");
   h2->Fit(func2,"r+");

}
