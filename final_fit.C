// gSystem->AddLinkedLibs("-lgsl -lgslcblas -lm");
// .include -I/usr/include
// Test to see how emacs works

// Most of these are not needed as the CINT loads them
#include <iostream>
#include "TString.h" 
#include "Riostream.h"
#include "TH2.h"
#include "TNtuple.h"
#include "TF1.h"
#include "TMath.h"
#include "TCanvas.h"
#include "TGraph.h"
#include "TGaxis.h"
#include <gsl/gsl_sf_lambert.h>


Double_t fitf(Double_t *x, Double_t *par)
{
// A simple function to create c*(x^n)
return par[0]*TMath::Power(x[0],par[1]);
}

Double_t fitLambertW(Double_t * x, Double_t *par) {
double prefactor = (par[0]*TMath::Power(x[0],par[1]));
return prefactor * gsl_sf_lambert_W0( (1e-3)/(par[2]*prefactor) );
}

void final_fit() {

// make sure this happens after the file is closed!
// TGraph *g2 = new TGraph("cut_data.dat",format="%lg %lg",option=":,");

// Creates a Root function based on function fitf above
TF1 *func = new TF1("fitf",fitf,1E9,1E12,2);
TF1 *func2 = new TF1("fitf",fitf,4E12,5E14,2);
TF1 *lambertfunc = new TF1("fitLambertW",fitLambertW,5e12,5E15,3);
TF1 *lambertCERNfunc = new TF1("fitLambertW",fitLambertW,5e12,1E16,3);
// TF1 *func2 = new TF1("fitLambertW",fitf,1E13,1.1E16,3);

// Sets initial values (guesses)
func->SetParameters(0.5,0); 
func2->SetParameters(0.5,0);
// lambertfunc->SetParameters(4.27e-11,0.83,4.9e-6); // Based on the other straight line
lambertfunc->SetParameters(1.9e-17,1.279,1.1e-5); // Based on initial fits
lambertCERNfunc->SetParameters(4.27e-18,1.289,4.9e-6); // Based on initial fits

// Fit histogram in range defined by function

// h2->Fit(func2,"r+");

lambertCERNfunc->SetLineColor(4);
lambertCERNfunc->SetLineWidth(2);
lambertCERNfunc->SetLineStyle(2);


 TCanvas *c1 = new TCanvas("c1","c1",1000,800);
// TGaxis *axis1 = new TGaxis(1E10,0.5,1E17,2E2,0,0);

// c1->cd(); // I think this command makes c1 the default canvas
 
 TH2F *hpx = new TH2F("hpx"," Forward Voltage V_{F} vs. Fluence n_{eq} (with CERN data)",10,1E10,6.4E16,100,0.2,210.0);
// axis range
hpx->SetStats(kFALSE);// no statistics
hpx->Draw();
TGraph *gr1 = new TGraph("cut_data.dat");
gr1->SetTitle("Fluence vs. Forward Voltage");
gr1->SetFillColor(1);
gr1->SetMarkerStyle(3);

TGraph *cernGraph = new TGraph("CERN_guessed_data.dat");

gr1->Fit(func,"r");
gr1->Fit(lambertfunc,"r+");
 // c1->Divide(1,2);
 // c1->cd(1);
// h2->SetMarkerStyle(2);
// h2->SetMarkerSize(0.6);
// h2->Draw(); 			// minor change

// c1->cd(2);
cernGraph->Draw("*");
cernGraph->SetMarkerStyle(4);
// cernGraph->GetXaxis()->SetRangeUser(5E10,6.4E20);// axis1->Draw("same");
gr1->Draw("*");
// gr1->GetXaxis()->SetRangeUser(5E10,6.4E20);// axis1->Draw("same");


lambertCERNfunc->Draw("same");
// gr1->Draw();
// c1->cd(2);
// lambertfunc->Draw();

c1->SetLogx(1);
c1->SetLogy(1);

}
